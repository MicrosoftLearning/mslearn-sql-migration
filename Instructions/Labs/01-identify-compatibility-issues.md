---
lab:
    title: 'Identify compatibility issues for SQL migration'
---

# Identify compatibility issues for SQL migration

In our scenario, you've been asked to assess the readiness of a legacy SQL Server database for migration to Azure SQL Database. Your task is to perform an assessment of their legacy database and identify any potential compatibility issues or changes that need to be made before migration. You should also review the schema of the database and identify any features or configurations that aren't supported in Azure SQL Database.

This exercise will take approximately **15** minutes.

> **Note**: To complete this exercise, you need access to an Azure subscription to create Azure resources. If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?azure-portal=true) before you begin.

## Before you start

To run this exercise, ensure you have the following in place before proceeding:

- You’ll need SQL Server 2019 or a later version, along with the [**AdventureWorksLT**](https://learn.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver16&tabs=ssms) lightweight database that is compatible with your specific SQL Server instance.
- Download and install [Azure Data Studio](https://learn.microsoft.com/sql/azure-data-studio/download-azure-data-studio). If it's already installed, update it to make sure that you’re using the most recent version.
- A SQL user with read access to the source database.

## Restore a SQL Server database and run a command

1. Select the Windows Start button and type SSMS. Select **Microsoft SQL Server Management Studio 18** from the list.  

1. When SSMS opens, notice that the **Connect to Server** dialog will be pre-populated with the default instance name. Select **Connect**.

1. Select the **Databases** folder, and then **New Query**.

1. In the new query window, copy and paste the below T-SQL into it. Execute the query to restore the database.

    ```sql
    RESTORE DATABASE AdventureWorksLT
    FROM DISK = 'C:\LabFiles\AdventureWorksLT2019.bak'
    WITH RECOVERY,
          MOVE 'AdventureWorksLT2019_Data' 
            TO 'C:\LabFiles\AdventureWorksLT2019.mdf',
          MOVE 'AdventureWorksLT2019_Log'
            TO 'C:\LabFiles\AdventureWorksLT2019.ldf';
    ```

    > **Note**: Ensure that the database backup file name and path in the above example match your actual backup file. If they don’t, the command may fail.

1. You should see a successful message after the restore is complete.

1. Run the following command on the **AdventureWorksLT** database in the SQL Server instance.

```sql
ALTER TABLE [SalesLT].[Customer] ADD [Next] VARCHAR(5);
```

## Install and launch the Azure migration extension for Azure Data Studio

Follow these steps to install the migration extension. If Azure migration extension is already installed, you can skip these steps.

1. Open the extensions manager in Azure Data Studio. s

1. Search for ***Azure SQL Migration***, and install the extension. Once you install it, the Azure SQL Migration extension is in the list of installed extensions.

1. Select the **Connections** icon, and then select **New Connection**. 

1. In the new **Connection** tab, type the server name. Select **Optional (False)** for the **Encrypt** option.

1. Select **Connect**. 

1. To launch the Azure migration extension, simply right-click on the name of the source instance and select **Manage**. 

1. In the server menu, under **General**, select **Azure SQL Migration**. This will take you to the main page of the Azure SQL Migration extension.

    > **Note**: If you're unable to see the **Azure SQL Migration** option in the server menu, or if the Azure SQL Migration page doesn't load, reopen Azure Data Studio.

## Run the compatibility assessment

The compatibility assessment helps identify potential migration issues and provides detailed guidance on how to resolve them before the migration process begins. This can save significant time and resources. 

You'll run the Azure migration extension for Azure Data Studio, run the compatibility assessment, and then view the results for an Azure SQL Database target.

1. In the Azure SQL Migration dashboard, select **Migrate to Azure SQL** to open the migration wizard.

1. On **Step 1: Databases for assessment**, select the *AdventureWorks* database, then select **Next**.

1. On **Step 2: Assessment results and recommendations**, wait for the assessment to complete.

## Review the assessment results

You are now able to review the recommendations generated by the migration extension.

1. On **Step 2: Assessment results and recommendations**, select **Azure SQL Database** as the target platform.

1. At the bottom of the page, select **View/Select** to view the assessment results. 

1. Select the *AdventureWorks* database. Take a moment to review the assessment results on the right side.
    
    > **Note:** We can see that the `Next` column that was added previously was flagged, as it may lead to an error in Azure SQL Database.

1. Select **Cancel** and choose **Azure SQL Managed Instance** instead as the **Azure SQL** target platform.
    
    > **Note:** The `Next` column is no longer flagged for Azure SQL Managed Instance, why is that? 
    >
    >This means that the `Next` column can be safely used on Azure SQL Managed Instance.

1. Select **Save assessment report** to save the report in a JSON format.

1. Take a moment to review the JSON file, and its properties.

## Fix the issue

1. Run the following T-SQL command on the *AdventureWorks* database.

    ```sql
    ALTER TABLE [SalesLT].[Customer] DROP COLUMN [Next];
    ```

1. Go back to the **Step 2: Assessment results and recommendations** page in the wizard, and select **Refresh assessment**.

1. Select **Azure SQL Database** as the **Azure SQL** target platform.

1. Select **View/Select** to view the assessment results.

    > **Note:** The issue is no longer flagged.

You've learned how to assess the readiness of a SQL Server database for migration to Azure SQL Database. By addressing compatibility issues and making essential schema changes or reporting them, you've taken an important step in mitigating potential technical issues that could arise in the future on Azure SQL Database.
