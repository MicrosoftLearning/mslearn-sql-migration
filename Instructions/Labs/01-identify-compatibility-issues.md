---
lab:
    title: 'Identify compatibility issues for SQL migration'
---

# Identify compatibility issues for SQL migration

In our scenario, you've been asked to assess the readiness of a legacy SQL Server database for migration to Azure SQL Database. Your task is to perform an assessment of their legacy database and identify any potential compatibility issues or changes that need to be made before migration. You should also review the schema of the database and identify any features or configurations that aren't supported in Azure SQL Database.

You already have Azure Data Studio installed in your machine with access to the database, and installing other tools requires approval from the IT department. You need to use the most appropriate tool for your specific requirement.

This exercise will take approximately **30** minutes.

> **Note**: To complete this exercise, you need access to an Azure subscription to create Azure resources. If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?azure-portal=true) before you begin.

## Before you start

To run this exercise, ensure you have the following in place before proceeding:

- You’ll need SQL Server 2019 or a later version, along with the [**AdventureWorksLT**](https://learn.microsoft.com/en-us/sql/samples/adventureworks-install-configure?view=sql-server-ver16&tabs=ssms) lightweight database that is compatible with your specific SQL Server instance.
- Download and install [Azure Data Studio](https://learn.microsoft.com/sql/azure-data-studio/download-azure-data-studio). If it's already installed, make sure that you’re using the most recent version.
- A SQL user with read access to the source database.
- Run the following command on the **AdventureWorksLT** database in SQL Server instance:

```sql
ALTER TABLE [Person].[Person] ADD [Next] VARCHAR(5);
```

## Install and launch the Azure migration extension for Azure Data Studio

Follow these steps to install the migration extension. If Azure migration extension is already installed, you can skip these steps.

1. Open the extensions manager in Azure Data Studio.

1. Search for ***Azure SQL Migration*** and select the extension.

1. Install the extension. Once you install it, the Azure SQL Migration extension is in the list of installed extensions.

1. Connect to a SQL Server instance in Azure Data Studio. In the new connection tab, select **Optional (False)** for the **Encrypt** option.

1. To launch the Azure migration extension, right-click on the source instance name and select **Manage** to access the dashboard and the landing page of the Azure SQL Migration extension.

    > **Note**: If the **Azure SQL Migration** option isn't visible in the dashboard side bar, reopen Azure Data Studio.

## Run the compatibility assessment

The compatibility assessment helps identify potential migration issues and provides detailed guidance on how to resolve them before the migration process begins. This can save significant time and resources. 

You'll run the Azure migration extension for Azure Data Studio, run the compatibility assessment, and then view the results for an Azure SQL Database target.

1. Launch Azure Data Studio, select **New Connection** to establish a connection to the SQL Server instance with the **AdventureWorks** database.
1. After the connection succeeds, right click on the instance name, and select **Manage**.
1. Once the dashboard shows, select **Azure SQL Migration** on the General section.
1. Select **Migrate to Azure SQL**. The extension wizard page will show.
1. On **Step 1: Databases for assessment**, select the **AdventureWorks** database, then select **Next**.
1. On **Step 2: Assessment results and recommendations**, wait for the assessment to complete.

## Review the assessment results

You are now able to review the recommendations generated by the migration extension.

1. On **Step 2: Assessment results and recommendations**, select **Azure SQL Database** as the **Azure SQL** target platform.
1. At the bottom of the page, select **View/Select** to view the assessment results. 
1. Select the **AdventureWorks** database. Take a moment to review the assessment results on the right side.
    We can see that the [Next] column that was added previously was flagged, as it may lead to an error in Azure SQL Database.
1. Select **Cancel** and choose **Azure SQL Managed Instance** instead as the **Azure SQL** target platform.
    >[!NOTE]
    >The [Next] column that was added previously is no longer flagged for Azure SQL Managed Instance, why is that? 
    >
    >This means that the [Next] column can be safely used on Azure SQL Managed Instance.
1. Alternatively, select **Save assessment report** to save the report in a JSON format.
1. Take a moment to review the JSON file, and its properties.

## Fix the issue

1. Run the following T-SQL command on the **AdventureWorks** database.
    ```sql
    ALTER TABLE [Person].[Person] DROP COLUMN [Next];
    ```
1. Go back to the assessment page in the wizard, make sure to select **Azure SQL Database** as the **Azure SQL** target platform.
1. Select **View/Select** to view the assessment results.
1. You can see that the issue is no longer being flagged.

You've learned how to assess the readiness of a SQL Server database for migration to Azure SQL Database. By addressing compatibility issues and making essential schema changes or reporting them, you've taken an important step in mitigating potential technical issues that could arise in the future on Azure SQL Database.
